%% Definition of model
M.name = 'CR_RRE_timedep'; 
M.n_subpop = 2; 
M.model = @(T,theta,u)simulate_CR(T,theta,[]); 
M.theta = @(xi,u)[(2592480341699211*u(2)*xi(1))/1125899906842624 - (2592480341699211*xi(2)*(u(2) - 1))/1125899906842624;(2592480341699211*xi(3))/1125899906842624;(2592480341699211*xi(4))/1125899906842624];
M.dthetadxi= @(xi,u)[(2592480341699211*u(2))/1125899906842624,2592480341699211/1125899906842624 - (2592480341699211*u(2))/1125899906842624,0,0,0,0,0,0,0,0,0,0,0,0,0;...
	0,0,2592480341699211/1125899906842624,0,0,0,0,0,0,0,0,0,0,0,0;...
	0,0,0,2592480341699211/1125899906842624,0,0,0,0,0,0,0,0,0,0,0];

% Subpopulation 1 
% Experiment 1 
s=1; e=1;
M.mean_ind{s,e} = [1];
M.var_ind{s,e} = [];
M.w_ind{s,e} = [];
M.mu{s,e} = @(t,x,sigma,xi,u) [log(x(:,1)) - sigma.^2/2];
M.dmudxi{s,e} = @(t,x,dxdxi,sigma,dsigmadxi,xi,u) bsxfun(@plus, [bsxfun(@rdivide, permute(dxdxi(1,:,:),[3,2,1]), x(:,1))],...
	bsxfun(@plus,[bsxfun(@times, -dsigmadxi, sigma)],...
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));

M.sigma{s,e} = @(t,x,xi,u)	[10^xi(6);10^xi(7);10^xi(8);10^xi(9);10^xi(10)];
M.dsigmadxi{s,e} = @(t,x,dxdxi,xi,u)	bsxfun(@plus, [0;0;0;0;0],...
	[0,0,0,0,0,10^xi(6)*log(10),0,0,0,0,0,0,0,0,0;...
	0,0,0,0,0,0,10^xi(7)*log(10),0,0,0,0,0,0,0,0;...
	0,0,0,0,0,0,0,10^xi(8)*log(10),0,0,0,0,0,0,0;...
	0,0,0,0,0,0,0,0,10^xi(9)*log(10),0,0,0,0,0,0;...
	0,0,0,0,0,0,0,0,0,10^xi(10)*log(10),0,0,0,0,0]);

M.w{s,e} = @(t,x,xi,u)[xi(5);xi(5);xi(5);xi(5);xi(5)];
M.dwdxi{s,e} = @(t,x,dxdxi,xi,u)bsxfun(@plus, [0;0;0;0;0],...
	[0,0,0,0,1,0,0,0,0,0,0,0,0,0,0;...
	0,0,0,0,1,0,0,0,0,0,0,0,0,0,0;...
	0,0,0,0,1,0,0,0,0,0,0,0,0,0,0;...
	0,0,0,0,1,0,0,0,0,0,0,0,0,0,0;...
	0,0,0,0,1,0,0,0,0,0,0,0,0,0,0]);
M.distribution{s,e} = 'logn_mean';

M.u{s,e} = [1];
r=1;
M.scaling{r,e} = @(xi,u)[1];
M.offset{r,e} = @(xi,u)[0];
M.dscalingdxi{r,e} = @(xi,u)[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
M.doffsetdxi{r,e} = @(xi,u)[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
% Subpopulation 2 
% Experiment 1 
s=2; e=1;
M.mean_ind{s,e} = [1];
M.var_ind{s,e} = [];
M.w_ind{s,e} = [];
M.mu{s,e} = @(t,x,sigma,xi,u) [log(x(:,1)) - sigma.^2/2];
M.dmudxi{s,e} = @(t,x,dxdxi,sigma,dsigmadxi,xi,u) bsxfun(@plus, [bsxfun(@rdivide, permute(dxdxi(1,:,:),[3,2,1]), x(:,1))],...
	bsxfun(@plus,[bsxfun(@times, -dsigmadxi, sigma)],...
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));

M.sigma{s,e} = @(t,x,xi,u)	[10^xi(11);10^xi(12);10^xi(13);10^xi(14);10^xi(15)];
M.dsigmadxi{s,e} = @(t,x,dxdxi,xi,u)	bsxfun(@plus, [0;0;0;0;0],...
	[0,0,0,0,0,0,0,0,0,0,10^xi(11)*log(10),0,0,0,0;...
	0,0,0,0,0,0,0,0,0,0,0,10^xi(12)*log(10),0,0,0;...
	0,0,0,0,0,0,0,0,0,0,0,0,10^xi(13)*log(10),0,0;...
	0,0,0,0,0,0,0,0,0,0,0,0,0,10^xi(14)*log(10),0;...
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,10^xi(15)*log(10)]);

M.w{s,e} = @(t,x,xi,u)[1 - xi(5);1 - xi(5);1 - xi(5);1 - xi(5);1 - xi(5)];
M.dwdxi{s,e} = @(t,x,dxdxi,xi,u)bsxfun(@plus, [0;0;0;0;0],...
	[0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0;...
	0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0;...
	0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0;...
	0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0;...
	0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0]);
M.distribution{s,e} = 'logn_mean';

M.u{s,e} = [0];
r=1;
M.scaling{r,e} = @(xi,u)[1];
M.offset{r,e} = @(xi,u)[0];
M.dscalingdxi{r,e} = @(xi,u)[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
M.doffsetdxi{r,e} = @(xi,u)[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];


parameters.name = {'log_{10}(k_{1,1})',...
'log_{10}(k_{1,2})',...
'log_{10}(k_{2})',...
'log_{10}(k_3)',...
'w',...
'log_{10}(\sigma_{exp. 1, t=0, u=1 s = 1 }',...
'log_{10}(\sigma_{exp. 1, t=0.1, u=1 s = 1 }',...
'log_{10}(\sigma_{exp. 1, t=0.5, u=1 s = 1 }',...
'log_{10}(\sigma_{exp. 1, t=1, u=1 s = 1 }',...
'log_{10}(\sigma_{exp. 1, t=2, u=1 s = 1 }',...
'log_{10}(\sigma_{exp. 1, t=0, u=1 s = 2 }',...
'log_{10}(\sigma_{exp. 1, t=0.1, u=1 s = 2 }',...
'log_{10}(\sigma_{exp. 1, t=0.5, u=1 s = 2 }',...
'log_{10}(\sigma_{exp. 1, t=1, u=1 s = 2 }',...
'log_{10}(\sigma_{exp. 1, t=2, u=1 s = 2 }'};
parameters.number = length(parameters.name);
parameters.max = [3;3;3;3;1;2;2;2;2;2;2;2;2;2;2];
parameters.min = [-3;-3;-3;-3;0;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2];
